package
{
	import flash.display.Graphics;
	import flash.display.Sprite;
	import flash.events.Event;
	import flash.events.MouseEvent;
	import flash.net.FileReference;
	import flash.text.TextField;
	import flash.utils.ByteArray;
	
	import mx.core.ButtonAsset;
	
	public class Compression extends Sprite
	{
		private var _file:FileReference;
		
		private var _compessBtn:Sprite;
		private var _uncompessBtn:Sprite;
		
		public function Compression()
		{
			_file = new FileReference();
			
			// 圧縮ボタン
			_compessBtn = createBtn('圧縮する', onSelectFile);
			addChild(_compessBtn);
			// 回答ボタン
			_uncompessBtn = createBtn('解凍する', onSelectFile);
			_uncompessBtn.x = _compessBtn.x + _compessBtn.width + 10; 
			addChild(_uncompessBtn);
		}
		
		protected function onClickStage(event:MouseEvent):void
		{
			// TODO Auto-generated method stub
			_file.addEventListener(Event.SELECT, onSelectFile);
			_file.addEventListener(Event.COMPLETE, onCompleteFileLoad);
			_file.browse();
		}
		
		protected function onSelectFile(event:Event):void
		{
			// TODO Auto-generated method stub
			_file.removeEventListener(Event.SELECT, onSelectFile);
			_file.load();
		}

		protected function onCompleteFileLoad(event:Event):void
		{
			// TODO Auto-generated method stub
			_file.removeEventListener(Event.COMPLETE, onCompleteFileLoad);
			
			var data:ByteArray = new ByteArray();
			data.writeBytes(_file.data);
//			data.compress();
			data.uncompress();
			
			_file.save(data, 'panel.dat');
		}
		
		private function createBtn(label:String, handler:Function):Sprite
		{
			var tf:TextField = new TextField();
			tf.text = label;
			tf.textColor = 0xFFFFFF;
			tf.backgroundColor = 0xaaaaaa;
			
			var btnElement:Sprite = new Sprite();
			var g:Graphics = btnElement.graphics;
			g.beginFill(0x000000);
			g.drawRect(0, 0, tf.textWidth + 5, tf.textHeight + 5);
			g.endFill();
			
			tf.x = (btnElement.width - tf.textWidth) / 2.0;
			tf.y = (btnElement.height - tf.textHeight) / 2.0;
			btnElement.addChild(tf);
			
			btnElement.addEventListener(MouseEvent.CLICK, handler);
			
			return btnElement;
		}
	}
}